{"hidden":false,"children":[{"configs":{"itemId":"module"},"expanded":true,"children":[{"configs":{"layout":"absolute","itemId":"editWin","focusControl":"EMPLOYEE_CODE","editWin":"true","width":"576","height":"440"},"expanded":true,"children":[{"configs":{"allowBlank":"false","itemId":"EMPLOYEE_CODE","labelAlign":"right","fieldLabel":"员工编号","width":"264","x":"0","y":"24","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"REAL_NAME","labelAlign":"right","fieldLabel":"姓名","width":"264","x":"272","y":"24","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"BIRTH_DATE","labelAlign":"right","fieldLabel":"出生日期","width":"264","x":"0","y":"56","height":"22"},"expanded":false,"children":[],"type":"date"},{"configs":{"allowBlank":"false","itemId":"SEX","labelAlign":"right","fieldLabel":"性别","keyName":"sex","width":"264","x":"272","y":"56","height":"22"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"NATION","labelAlign":"right","fieldLabel":"民族","keyName":"nation","width":"264","x":"0","y":"88","height":"22"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"EMAIL","vtype":"email","labelAlign":"right","fieldLabel":"电子邮件","width":"264","x":"272","y":"88","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"itemId":"VACATION_HOURS","minValue":"0","labelAlign":"right","fieldLabel":"休假时长","width":"264","x":"0","y":"120","height":"22"},"expanded":false,"children":[],"type":"number"},{"configs":{"itemId":"COMPANY_NAME","labelAlign":"right","bindField":"COMPANY_ID","fieldLabel":"负责公司","width":"264","x":"272","displayField":"COMPANY_NAME","y":"120","height":"22"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=examples/templates/employee/edit/company-list"},"expanded":false,"children":[],"type":"store"}],"type":"combo"},{"configs":{"layout":"fit","itemId":"fieldset1","padding":"8","width":"504","x":"32","y":"152","title":"备注：","height":"208"},"expanded":true,"children":[{"configs":{"itemId":"REMARK"},"expanded":false,"children":[],"type":"textarea"}],"type":"fieldset"}],"type":"window","events":{"ok":"var values = Wb.getValue(app.editWin);\nif (app.isEdit) {\n  //点击修改按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=examples/templates/employee/dialog/update',\n    params: Wb.applyIf(values, Wb.getData(app.selRec, true)), //合并窗口和记录数据作为参数，后者为默认值\n    success: function() {\n      //把窗口数据更新到选择记录中\n      Wb.update(app.selRec, values);\n      //隐藏对话框，在模块关闭时自动销毁对话框\n      app.editWin.close();\n    }\n  });\n} else {\n  //点击添加按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=examples/templates/employee/dialog/insert',\n    out: app.editWin,\n    params: {\n      DEPT_ID: app.selDept.data.DEPT_ID\n    },\n    success: function(resp) {\n      //把服务器返回的数据合并窗口数据（公司名称等数据）添加到表格中\n      Wb.add(app.grid1, Wb.apply(Wb.decode(resp.responseText), values));\n      //隐藏对话框，在模块关闭时自动销毁对话框\n      app.editWin.close();\n    }\n  });\n}"}},{"configs":{"layout":"border","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"itemId":"toolbar1","region":"north"},"expanded":true,"children":[{"configs":{"itemId":"newBtn","tooltip":"添加新的记录 (Ctrl+E)","text":"添加","iconCls":"record_add_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"if (!app.selDept) {\n  Wb.warn('部门未选择。');\n  return;\n}\napp.editWin.show();\napp.editWin.setTitle('添加 - ' + app.selDept.data.DEPT_NAME);\napp.editWin.setIconCls('record_add_icon');\napp.isEdit = false; //标识是否为添加或修改状态，在editWin的ok事件中用到此属性"}},{"configs":{"itemId":"editBtn","tooltip":"修改选择的记录","text":"修改","iconCls":"record_edit_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"var sels = app.grid1.getSelection();\nif (sels.length != 1) {\n  Wb.warn('请选择 1 条需要修改的记录。');\n  return;\n}\napp.selRec = sels[0];\napp.editWin.show();\napp.editWin.setTitle('修改 - ' + app.selRec.data.REAL_NAME);\napp.editWin.setIconCls('record_edit_icon');\nWb.setValue(app.editWin, app.selRec.data);\napp.isEdit = true; //标识是否为添加或修改状态，在editWin的ok事件中用到此属性"}},{"configs":{"itemId":"delBtn","tooltip":"删除选择的记录","text":"删除","iconCls":"record_delete_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"var sels = app.grid1.getSelection();\nWb.confirmDo(sels, function() {\n  Wb.request({\n    url: 'm?xwl=examples/templates/employee/dialog/delete',\n    params: {\n      destroy: Wb.getData(sels, true)\n    },\n    success: function() {\n      Wb.remove(app.grid1, sels);\n    }\n  });\n}, 'REAL_NAME');"}},{"configs":{"itemId":"item1","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"searchCombo","onTriggerClick":"this.collapse();\napp.grid1.store.load({\n  out: app.toolbar1 //toolbar1内的所有控件值作为参数列表\n});","emptyText":"姓名","triggerCls":"x-form-search-trigger","width":"130","displayField":"REAL_NAME","enterKeyTriggerClick":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=examples/templates/employee/edit/search"},"expanded":false,"children":[],"type":"store"}],"type":"combo","events":{"select":"Ext.callback(combo.onTriggerClick, combo);"}},{"configs":{"itemId":"resetSearchBtn","tooltip":"重置搜索结果","text":"重置搜索","iconCls":"undo_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"app.loadData();"}}],"type":"toolbar"},{"configs":{"itemId":"deptTree","file":"m?xwl=examples/templates/employee/public/dept-tree"},"expanded":false,"children":[],"type":"xwl"},{"configs":{"itemId":"grid1","viewConfig":"{\n  plugins: {\n    ptype: 'gridviewdragdrop',\n    ddGroup: 'dept',\n    enableDrop: false\n  }\n}","region":"center","multiSelect":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","remoteSort":"true","sorters":"'EMPLOYEE_CODE'","url":"m?xwl=examples/templates/employee/edit/select"},"expanded":false,"children":[],"type":"store"},{"configs":{"itemId":"columns"},"expanded":true,"children":[{"configs":{"itemId":"numCol","xtype":"rownumberer"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"employeeCodeCol","dataIndex":"EMPLOYEE_CODE","width":"80","text":"员工编号"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"realNameCol","dataIndex":"REAL_NAME","width":"150","text":"姓名"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"birthDateCol","dataIndex":"BIRTH_DATE","width":"100","text":"出生日期"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"sexCol","dataIndex":"SEX","keyName":"sex","width":"50","text":"性别"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"nationCol","dataIndex":"NATION","keyName":"nation","width":"90","text":"民族"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"emailCol","dataIndex":"EMAIL","width":"150","text":"电子邮件"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"vacationHoursCol","dataIndex":"VACATION_HOURS","width":"70","format":"#,##0","text":"休假时长","align":"right"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"companyNAMECol","dataIndex":"COMPANY_NAME","width":"130","text":"负责公司"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"remarkCol","dataIndex":"REMARK","flex":"1","text":"备注"},"expanded":false,"children":[],"type":"column"}],"type":"array"}],"type":"grid","events":{"itemdblclick":"app.editBtn.fireEvent('click');"}}],"type":"viewport","events":{"afterrender":"app.navKey = new Ext.KeyNav({\n  viewport: app.viewport1,\n  E: {\n    ctrl: true,\n    fn: function() {\n      app.newBtn.fireEvent('click');\n    }\n  }\n});"}}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  /**\n   * tree1配置拖放事件，允许grid数据拖动到tree以调整人员所属部门。\n   */\n  treeViewConfig: {\n    plugins: {\n      ptype: 'treeviewdragdrop',\n      ddGroup: 'dept',\n      enableDrag: false\n    },\n    listeners: {\n      beforedrop: function(node, data, om, dp, dh) {\n        dh.wait = true;\n        dh.cancelDrop();\n        Wb.request({\n          url: 'm?xwl=examples/templates/employee/edit/change-dept',\n          params: {\n            newDeptId: om.data.DEPT_ID,\n            recs: Wb.getData(data.records)\n          },\n          success: function() {\n            Wb.remove(app.grid1);\n          }\n        });\n      },\n      nodedragover: function(node, dp, data) {\n        return dp == 'append' && app.selectDeptNode != node;\n      }\n    }\n  },\n  /**\n   * 加载指定部门的人员数据。\n   */\n  loadData: function() {\n    if (app.selDept)\n      app.grid1.store.load({\n        params: app.selDept.data\n      });\n  }\n});"}}],"roles":{"demo":1},"title":"对话框","iconCls":"","inframe":false,"pageLink":""}