{"hidden":false,"children":[{"configs":{"itemId":"module","loginRequired":"false"},"expanded":true,"children":[{"configs":{"layout":"absolute","itemId":"main","flat":"true","width":"376","height":"180"},"expanded":true,"children":[{"configs":{"allowBlank":"false","itemId":"username","labelAlign":"right","fieldLabel":"@Str.username","width":"296","x":"16","y":"32","fieldStyle":"padding-left:28px;background-image:url(wb/images/app/user.png);background-repeat:no-repeat;background-position:left center;","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"password","labelAlign":"right","fieldLabel":"@Str.password","width":"296","x":"16","y":"64","inputType":"password","fieldStyle":"padding-left:28px;background-image:url(wb/images/app/password.png);background-repeat:no-repeat;background-position:left center;","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"verifyCode","labelAlign":"right","fieldLabel":"@Str.verifyCode","width":"200","x":"16","y":"96","fieldStyle":"padding-left:28px;background-image:url(wb/images/app/check.png);background-repeat:no-repeat;background-position:left center;","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"itemId":"verifyImage","alt":"@Str.verifyCode","width":"90","x":"222","y":"97","style":"cursor:pointer;","title":"@Str.clickChangeVC","height":"20"},"expanded":false,"children":[],"type":"image","events":{"click":"app.changeVC();\napp.verifyCode.focus(true, true);"}},{"configs":{"itemId":"saveNameCheck","boxLabel":"@Str.saveUserName","width":"192","x":"120","y":"128","height":"22"},"expanded":false,"children":[],"type":"check","events":{"change":"if (!newValue)\n  Ext.util.Cookies.clear('sys.username');"}}],"type":"panel","events":{"beforerender":"app.verifyEnabled = '{#Var.sys.session.verifyImage.enabled#}' === 'true';\nif (app.verifyEnabled)\n  app.verifyImage.src = 'm?xwl=sys/session/get-verify-image';\nelse {\n  app.username.y += 10;\n  app.password.y += 20;\n  app.verifyCode.hidden = true;\n  app.verifyImage.hidden = true;\n}","afterrender":"var username = Wb.getCookie('sys.username');\nWb.monEnter(panel, function() {\n  app.login();\n});\napp.saveNameCheck.setValue(!!username);\nif (Wb.isEmpty(username)) {\n  //单独timeout防止focus任务被cancel\n  setTimeout(function() {\n    app.username.focus();\n  }, 50);\n} else {\n  app.username.setValue(username);\n  setTimeout(function() {\n    app.password.focus();\n  }, 50);\n}"}}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  changeVC: function() {\n    app.verifyImage.setSrc('m?xwl=sys/session/get-verify-image&' + Wb.getId());\n  },\n  /**\n   * 登录成功后的回调函数。可通过重载该方法来实现执行不同的回调功能。\n   * @param {Object} resp 包含响应数据的XMLHttpRequest对象。\n   */\n  loginSuccess: function(resp) {\n    if (app.saveNameCheck.getValue())\n      Wb.setCookie('sys.username', app.username.getValue());\n    window.location = app.main.referUrl || resp.responseText;\n  },\n  login: function() {\n    if (!Wb.verify(app.main))\n      return;\n    Wb.request({\n      url: 'verify-user',\n      out: app.main,\n      message: Str.processLogin,\n      showError: false,\n      success: app.loginSuccess,\n      failure: function(resp) {\n        if (app.verifyEnabled)\n          app.changeVC();\n        Wb.except(resp, function() {\n          var s = resp.responseText;\n          switch (s) {\n            case Str.vcInvalid:\n            case Str.vcExpired:\n              if (!app.verifyCode.hidden)\n                app.verifyCode.focus(true, true);\n              break;\n            case Str.passwordInvalid:\n              app.password.focus(true, true);\n              break;\n            default:\n              app.username.focus(true, true);\n              break;\n          }\n        });\n      }\n    });\n  },\n  reset: function() {\n    Wb.reset(app.main);\n  }\n});"}}],"roles":{"default":1},"title":"登录对话框","iconCls":"","inframe":false,"pageLink":""}