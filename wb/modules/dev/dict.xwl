{"hidden":false,"children":[{"configs":{"itemId":"module","serverMethod":"com.wb.interact.Tools.loadKeyNames"},"expanded":true,"children":[{"configs":{"layout":"border","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"itemId":"tableTree","split":"true","plugins":"{ptype:'bufferedrenderer'}","width":"200","region":"west","title":"数据库列表","iconCls":"db_icon","collapsible":"true","rootVisible":"false"},"expanded":false,"children":[{"configs":{"itemId":"store","fields":"['text', 'jndi', 'type', 'schema', 'table']","url":"m?xwl=dev/dict/get-tree"},"expanded":false,"children":[],"type":"treestore","events":{"beforeload":"operation.params = operation.node.data;"}},{"configs":{"itemId":"tools"},"expanded":true,"children":[{"configs":{"itemId":"refreshBtn","tooltip":"刷新","tooltype":"refresh"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.reload(app.tableTree);"}},{"configs":{"itemId":"setBtn","tooltip":"切换表名前Schem","tooltype":"gear"},"expanded":false,"children":[],"type":"item","events":{"click":"Ext.suspendLayouts();\napp.tableTree.getRootNode().cascadeBy(function(node) {\n  if (node.isLeaf()) {\n    node.set('text', node.data.table);\n    node.commit();\n  }\n});\nExt.resumeLayouts(true);"}}],"type":"array"}],"type":"tree","events":{"selectionchange":"var tableName, jndi, grid = app.grid1,\n  rec = selected[0];\nif (rec && rec.isLeaf()) {\n  if (grid.disabled)\n    grid.setDisabled(false);\n  jndi = rec.data.jndi;\n  tableName = (jndi == 'default' ? '' : (jndi + '.')) + rec.data.table; //表名不带schema，如果非默认数据库则带jndi变量名前缀\n  app.tableName = tableName.toUpperCase();\n  app.jndi = rec.data.jndi;\n  app.fullTableName = Wb.addPrefix(rec.data.schema, rec.data.table);\n  Wb.setTitle(grid, tableName);\n  app.gridStore.load();\n}","afterrender":"Wb.setNavigate(tree, app.backBtn, app.forwardBtn);"}},{"configs":{"itemId":"grid1","disabled":"true","region":"center","title":"字段字典定义","iconCls":"book_icon","multiSelect":"true"},"expanded":true,"children":[{"configs":{"itemId":"tbar","enableOverflow":"true","region":"north"},"expanded":true,"children":[{"configs":{"itemId":"newBtn","tooltip":"添加新的记录 (Ctrl+E)","text":"添加","iconCls":"record_add_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"var win;\nwin = Wb.insert(app.grid1, {\n  title: '添加 - ' + app.tableName,\n  width: 650,\n  url: 'm?xwl=dev/dict/insert',\n  windowName: 'sys.dev.dict.editWin', //单例模式，关闭时隐藏\n  destroyOn: app.viewport1, //在viewport1销毁时销毁该窗口\n  resetScrollbar: true,\n  params: {\n    TABLE_NAME: app.tableName\n  }\n});\napp.reloadFields(win);"}},{"configs":{"itemId":"editBtn","tooltip":"修改选择的记录","text":"修改","iconCls":"record_edit_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"var win = Wb.edit(app.grid1, {\n  url: 'm?xwl=dev/dict/update',\n  titleField: 'FIELD_NAME',\n  width: 650,\n  focusControl: null, //修改时不要设置焦点，方便还原上次状态\n  windowName: 'sys.dev.dict.editWin', //单例模式，关闭时隐藏\n  destroyOn: app.viewport1, //在viewport1销毁时销毁该窗口\n  params: {\n    TABLE_NAME: app.tableName\n  }\n});\nif (win)\n  app.reloadFields(win);"}},{"configs":{"itemId":"delBtn","tooltip":"删除选择的记录","text":"删除","iconCls":"record_delete_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.del(app.grid1, {\n  url: 'm?xwl=dev/dict/delete',\n  titleField: 'FIELD_NAME'\n});"}},{"configs":{"itemId":"item1","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"item3","xtype":"tbtext","text":"搜索："},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"searchCombo","onTriggerClick":"app.search();","emptyText":"字段名称","triggerCls":"x-form-search-trigger","width":"230","displayField":"FIELD_NAME","enterKeyTriggerClick":"true","fieldStyle":"text-transform:uppercase;"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=dev/dict/search"},"expanded":false,"children":[],"type":"store","events":{"beforeload":"operation.params.TABLE_NAME = app.tableName;"}}],"type":"combo","events":{"beforequery":"plan.query = (plan.query || '').toUpperCase();","select":"app.search();"}},{"configs":{"itemId":"resetSearchBtn","tooltip":"重置搜索条件","iconCls":"undo_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"app.search(true);"}},{"configs":{"itemId":"item2","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"backBtn","tooltip":"转到上一个页面","text":"返回","iconCls":"left_icon"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"forwardBtn","tooltip":"转到后退前的页面","text":"前进","iconCls":"right_icon"},"expanded":false,"children":[],"type":"item"}],"type":"toolbar"},{"configs":{"itemId":"store","remoteSort":"true","normalName":"gridStore","sorters":"'FIELD_NAME'","url":"m?xwl=dev/dict/select"},"expanded":false,"children":[],"type":"store","events":{"success":"var col, grid = app.grid1;\napp.fieldNameList = Wb.getTag(grid, 'tableFields');\nWb.each(app.fieldNameList, function(item) {\n  item.name = item.name.toUpperCase();\n});\nif (!grid.colsLoaded) {\n  col = Wb.getColumn(grid, 'FIELD_NAME');\n  col.editor = {\n    xtype: 'combo',\n    allowBlank: false,\n    queryMode: 'local',\n    displayField: 'name',\n    fieldStyle: 'text-transform:uppercase', //强制大写，避免不同数据库之间的差异\n    getValue: function() { //重载getValue使其取值大写\n      var val = Ext.form.field.ComboBox.prototype.getValue.apply(this);\n      return val ? val.toUpperCase() : val;\n    },\n    store: {\n      fields: ['name']\n    }\n  };\n  col = Wb.getColumn(grid, 'KEY_NAME');\n  col.editor = {\n    xtype: 'combo',\n    store: Wb.decode(\"{#keyNameList#}\")\n  };\n  grid.colsLoaded = true;\n}","beforeload":"if (!operation.params)\n  operation.params = {};\nWb.apply(operation.params, {\n  jndi: app.jndi,\n  fullTableName: app.fullTableName,\n  TABLE_NAME: app.tableName\n});"}}],"type":"grid","events":{"itemdblclick":"app.editBtn.fireEvent('click');"}}],"type":"viewport","events":{"afterrender":"new Ext.KeyNav({\n  viewport: app.viewport1,\n  E: {\n    ctrl: true,\n    fn: function() {\n      if (!app.newBtn.disabled)\n        app.newBtn.fireEvent('click');\n    }\n  }\n});"}}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  reloadFields: function(win) {\n    var items = [],\n      existFields = {};\n    app.gridStore.each(function(item) {\n      existFields[item.data.FIELD_NAME] = true;\n    });\n    Wb.each(app.fieldNameList, function(item) {\n      if (!existFields[item.name])\n        items.push(item);\n    });\n    win.down('#FIELD_NAME').store.loadData(items);\n  },\n  search: function(reset) {\n    app.searchCombo.collapse();\n    app.gridStore.load(reset ? null : {\n      out: app.grid1.down('toolbar')\n    });\n  }\n});"}}],"roles":{"demo":1},"title":"数据字典","iconCls":"book_icon","inframe":false,"pageLink":""}